
# Проект:  Продуктовый помощник
![Github actions](https://github.com/alexmatiya/foodgram-project-react/actions/workflows/main.yml/badge.svg)

## Описание:
Данный сайт является продуктовым помощником, здесь можно публиковать рецепты, смотреть рецепты других пользователей, добавлять рецепты в избранное, подписываться на других пользователей. Также есть функция скачивания списка ингредиентов для выбранных рецептов.

## Стек технологий:
- Python 3.8.10
- Django Rest Framework
- React
- PostgreSQL
- CI/CD Github Actions
- Docker Docker-compose DockerHub
- YandexCloud
- Nginx
- Telegram

## Запуск сайта на сервере:
#### 1.  Установливаем на сервере docker и docker-compose.
#### 2.  Копируем на сервер файлы `docker-compose.yaml` и `nginx.conf` удобным для вас способом(через scp или sftp).
#### 3.  В Secrets на Github добаваляем переменные:
- Для подключения к базе данных:
```
DB_ENGINE=django.db.backends.postgresql # указать, что проект работает с postgresql
DB_NAME=postgres # имя базы данных
POSTGRES_USER=postgres # логин для подключения к базе данных
POSTGRES_PASSWORD=postgres # пароль для подключения к БД
DB_HOST=db # название сервиса БД (контейнера) 
DB_PORT=5432 # порт для подключения к БД
```
- Для подключения к DockerHub:
```
DOCKER_PASSWORD= # Пароль на DockerHub
DOCKER_USERNAME= # Username на DockerHub
HOST= # IP удалённого сервера
USER= # Логин на удалённом сервере
```
- Для соеденения вашего ПК с сервером:
```
SSH_KEY= # SSH-key компьютера, с которого будет происходить подключение к удалённому серверу
PASSPHRASE= # Если для ssh используется пароль
```
- Для возможности отправлять уведомления в Telegram:
```
TELEGRAM_TO= # ID пользователя в Telegram
TELEGRAM_TOKEN= # ID бота в Telegram
```
#### 4. Запускаем workflow:
```
git add .
git commit -m "initial commit"
git push
```

В файле .github/workflows/main.yml описаны процесы, которые пройдут при git push
```
- весь проект пройдет проверку на PEP8
- соберется окер-образ и отправится на DockerHub
- если пушите в ветку master, то произойдет автоматический deploy на сервер.
- отправится уведомление в telegram
```
#### 5. После успешной отработки workflow нужно выполнить команды:
1. Прогнать миграции:
```
sudo docker-compose exec web manage.py migrate
```
2. Создать суперюзера:
```
sudo docker-compose exec web python manage.py createsuperuser
```
3. Собрать статику:
```
sudo docker-compose exec web python manage.py collectstatic --no-input
```
4. Загрузить ингредиенты:
```
sudo docker-compose exec web python manage.py loaddata --path recipes/management/commands/ingredients.csv
```
5. Зайти под суперпользователем в админку, добавить тегов, проверить работоспособность.
----------------------
#
#
# API
Также есть возможность пользоваться API  по таким ендпоинтам:

- `/api/users/`
```
Get – получение списка пользователей.
POST – регистрация нового пользователя. Доступно без токена.
```
- `/api/users/{id}`
```
GET – персональная страница пользователя с указанным id (доступно без токена).
```
- `/api/users/me/`
```
GET – страница текущего пользователя.
PATCH – редактирование собственной страницы. Доступно авторизированным пользователям.
```
- `/api/users/set_password`
```
POST – изменение собственного пароля. Доступно авторизированным пользователям.
```
- `/api/auth/token/login/`
```
POST – получение токена. Используется для авторизации по емейлу и паролю, чтобы далее использовать токен при запросах.
```
- `/api/auth/token/logout/`
```
POST – удаление токена.
```
- `/api/tags/`
```
GET — получение списка всех тегов. Доступно без токена.
```
- `/api/tags/{id}`
```
GET — получение информации о теге о его id. Доступно без токена.
```
- `/api/ingredients/`
```
GET – получение списка всех ингредиентов. Доступно без токена.
```
- `/api/ingredients/{id}/`
```
GET — получение информации об ингредиенте по его id. Доступно без токена.
```
- `/api/recipes/`
```
GET-запрос – получение списка всех рецептов. Возможен поиск рецептов по тегам и по id автора. Доступно без токена.
POST-запрос – добавление нового рецепта. Доступно авторизированным пользователям.
```
- `/api/recipes/?is_favorited=1`
```
GET-запрос – получение списка всех рецептов, добавленных в избранное. Доступно авторизированным пользователям.
```
- `/api/recipes/is_in_shopping_cart=1`
```
GET-запрос – получение списка всех рецептов, добавленных в список покупок.  Доступно авторизированным пользователям.
```
- `/api/recipes/{id}/`
```
GET – получение информации о рецепте по его id. Доступно без токена.
PATCH – изменение собственного рецепта. Доступно для автора рецепта. 
DELETE – удаление собственного рецепта. Доступно для автора рецепта.
```
- `/api/recipes/{id}/favorite/`
```
POST – добавление нового рецепта в избранное.
DELETE – удаление рецепта из избранного. Доступно авторизированным пользователям.
 ```
- `/api/recipes/{id}/shopping_cart/`
```
POST – добавление нового рецепта в список покупок.
DELETE – удаление рецепта из списка покупок. Доступно авторизированным пользователям.
 ```
- `/api/recipes/download_shopping_cart/`
```
GET – получение текстового файла со списком покупок. Доступно авторизированным пользователям.
```
- `/api/users/{id}/subscribe/`
```
GET – подписка на пользователя с указанным id.
POST – отписка от пользователя с указанным id. Доступно авторизированным пользователям.
```
- `/api/users/subscriptions/`
```
GET– получение списка всех пользователей, на которых подписан текущий пользователь. Доступно авторизированным пользователям.
```

### Автор Проекта:
`Матияка Александр`